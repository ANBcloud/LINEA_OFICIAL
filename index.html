<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Redirecting…</title>
</head>
<body>
<script>
(async () => {
  const API_URL = 'https://ikdh2froxk.execute-api.us-east-2.amazonaws.com/default/BK';
  const HARD_CODED_MESSAGE = 'Hola, quiero información por favor.';

  try {
    const resp = await fetch(API_URL, { method: 'GET', cache: 'no-store', mode: 'cors' });

    let line = null;
    try {
      const j = await resp.clone().json().catch(() => null);
      if (j) {
        if (typeof j.line === 'string') line = j.line;
        else if (typeof j === 'string') line = j;
      }
    } catch (e) { }

    if (!line) {
      try {
        const txt = await resp.text();
        if (txt && txt.trim().length) line = txt.trim();
      } catch (e) { }
    }

    if (!line) throw new Error('No se recibió ninguna línea válida desde el backend.');

    const digits = line.replace(/\D+/g, '');
    if (!digits) throw new Error('La línea recibida no contiene dígitos.');

    const encodedMsg = encodeURIComponent(HARD_CODED_MESSAGE);
    const waUrl = `https://wa.me/${digits}?text=${encodedMsg}`;

    window.location.replace(waUrl);

  } catch (err) {
    console.error(err);
    document.body.style.fontFamily = 'system-ui, Arial, sans-serif';
    document.body.style.margin = '20px';
    document.body.innerHTML = '<p>Error al obtener la línea activa: ' + (err.message || '') + '</p>';

    const info = document.createElement('p');
    info.innerHTML = 'Si quieres probar manualmente, abre la consola del navegador para ver detalles.';
    document.body.appendChild(info);
  }
})();
</script>
</body>
</html>
